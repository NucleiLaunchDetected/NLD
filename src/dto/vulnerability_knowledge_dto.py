from pydantic import BaseModel
from typing import Optional


class VulnerabilityBehavior(BaseModel):
    """취약점 동작 설명"""
    vulnerability_cause_description: str
    trigger_condition: str
    specific_code_behavior_causing_vulnerability: str


class VulnerabilityKnowledgeDTO(BaseModel):
    """Train 데이터를 추상화하여 RAG에 넣을 지식"""
    CVE_id: str
    
    # 중첩된 취약점 동작 정보
    vulnerability_behavior: VulnerabilityBehavior
    
    # 솔루션 및 분석
    solution: str
    purpose: str
    function: str
    analysis: str
    
    # 코드 정보
    code_before_change: str
    code_after_change: str
    modified_lines: dict  # {"added": [...], "deleted": [...]}
    
    # 최상위 레벨 취약점 정보 (중복이지만 JSON 구조에 따라 포함)
    vulnerability_cause_description: str
    trigger_condition: str
    specific_code_behavior_causing_vulnerability: str
    
    # Optional: 추가 메타데이터
    vuln_type: Optional[str] = None           # xss, info_leak, oob, ssti
    language: Optional[str] = None            # c, php, twig
    tags: Optional[list[str]] = None
